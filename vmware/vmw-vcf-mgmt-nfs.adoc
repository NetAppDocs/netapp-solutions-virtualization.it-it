---
sidebar: sidebar 
permalink: vmware/vmw-vcf-mgmt-nfs.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, array, ontap tools, otv, sddc, sddc manager, ontap tools, ontap tools 10 
summary:  
---
= Convertire l'istanza del server vCenter in dominio di gestione VCF (datastore NFS)
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Converti un cluster vSphere 8 esistente con datastore NFS NetApp ONTAP in un dominio di gestione VMware Cloud Foundation (VCF).  Questa procedura include il provisioning dello storage NFS, l'implementazione degli strumenti ONTAP per VMware e l'utilizzo dello strumento di importazione VCF per convertire il cluster per una gestione semplificata e un utilizzo ottimizzato delle risorse all'interno di VCF.



== Introduzione

La conversione di un cluster con un datastore NFS esistente in esecuzione su ONTAP implica l'integrazione dell'infrastruttura esistente in una moderna architettura cloud privata.  Questo processo trae vantaggio dalla flessibilità dell'archiviazione NFS, per garantire un accesso e una gestione dei dati senza interruzioni.  Dopo aver stabilito un dominio di gestione VCF tramite il processo di conversione, gli amministratori possono importare in modo efficiente altri cluster vSphere, compresi quelli che utilizzano datastore NFS, nell'ecosistema VCF.  Questa integrazione non solo migliora l'utilizzo delle risorse, ma semplifica anche la gestione dell'infrastruttura cloud privata, garantendo una transizione fluida con un'interruzione minima dei carichi di lavoro esistenti.

In questa soluzione mostreremo come un datastore NFS in vSphere 8 diventa un archivio principale quando il cluster viene convertito in un dominio di gestione VCF.



== Panoramica dello scenario

Questo scenario comprende i seguenti passaggi di alto livello:

* Distribuisci gli ONTAP tools for VMware vSphere 10.
* Fornire un datastore NFS utilizzando gli strumenti ONTAP .
* Utilizzare lo strumento di importazione VCF per convalidare il cluster vSphere.
* Distribuire SDDC Manager nel cluster vSphere.
* Configurare un file JSON per creare NSX durante la conversione VCF.
* Utilizzare lo strumento di importazione VCF per convertire il cluster vSphere 8 in VCF 5.2.




== Prerequisiti

Questo scenario richiede i seguenti componenti e configurazioni:

* Sistema di archiviazione NetApp AFF con una macchina virtuale di archiviazione (SVM) configurata per consentire il traffico NFS.
* È stata creata un'interfaccia logica (LIF) sulla rete IP che deve trasportare il traffico NFS ed è associata all'SVM.
* Un cluster vSphere 8 con 4 host ESXi e un'appliance vCenter collocata sul cluster.
* Gruppo di porte distribuito configurato per il traffico di archiviazione vMotion e NFS sulle VLAN o sui segmenti di rete stabiliti a tale scopo.
* Scarica il software necessario per la conversione VCF.


Gli ONTAP tools for VMware vSphere 10 possono essere installati in configurazioni HA o non HA.  Per informazioni complete sui prerequisiti per gli strumenti ONTAP fare riferimento a https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/deploy/prerequisites.html#system-requirements["Prerequisiti per gli ONTAP tools for VMware vSphere"] .

Per l'archiviazione supportata e altre considerazioni per la conversione o l'importazione di vSphere in VCF 5.2, fare riferimento a https://techdocs.broadcom.com/fr/fr/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/considerations-before-converting-or-importing-existing-vsphere-environments-into-vcf.html["Considerazioni prima di convertire o importare ambienti vSphere esistenti in VMware Cloud Foundation"] .

Per il software richiesto, vai a https://support.broadcom.com/["Portale di supporto Broadcom"] .

Per informazioni sulla configurazione dei sistemi di archiviazione ONTAP fare riferimento alink:https://docs.netapp.com/us-en/ontap["Documentazione ONTAP 9"] centro.

Per informazioni sulla configurazione di VCF fare riferimento alink:https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["Documentazione di VMware Cloud Foundation"] .



== Fasi di distribuzione

La soluzione prevede l'utilizzo di ONTAP tools for VMware vSphere per il provisioning di datastore NFS e il processo di conversione di un cluster vSphere 8 esistente in un dominio di gestione VCF.

Completare i seguenti passaggi:

* Distribuisci gli ONTAP tools for VMware vSphere 10.
* Fornire un datastore NFS utilizzando gli strumenti ONTAP .
* Copiare lo strumento di importazione VCF nell'appliance vCenter.
* Eseguire un controllo preliminare sull'appliance vCenter utilizzando lo strumento di importazione VCF.
* Distribuire la VM del gestore SDDC sul cluster vCenter.
* Creare un file JSON per un cluster NSX da distribuire durante il processo di conversione.
* Caricare il software richiesto nel gestore SDDC.
* Convertire il cluster vSphere nell'inventario del gestore SDDC.


Per una panoramica del processo di conversione, fare riferimento a https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/convert-or-import-a-vsphere-environment-into-vmware-cloud-foundation-admin.html["Convertire un ambiente vSphere in un dominio di gestione o importare un ambiente vSphere come dominio di carico di lavoro VI in VMware Cloud Foundation"] .



=== Distribuisci gli strumenti ONTAP e fornisci un datastore NFS

L'architettura degli strumenti ONTAP 10 è progettata per integrarsi perfettamente con gli ambienti VMware, sfruttando un framework modulare e scalabile che include i servizi degli strumenti ONTAP , il plug-in vSphere e le API REST per consentire una gestione efficiente dello storage, l'automazione e la protezione dei dati.

Gli ONTAP tools for VMware vSphere 10 possono essere installati in configurazioni HA o non HA.

image:vmware-vcf-import-nfs-010.png["Architettura degli strumenti ONTAP"]

.Distribuisci gli ONTAP tools for VMware vSphere 10
[%collapsible%open]
====
In questa fase gli strumenti ONTAP 10 vengono distribuiti con una configurazione non HA.

Per ulteriori dettagli sulla distribuzione delle configurazioni HA e non HA, fare riferimento a https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/deploy/ontap-tools-deployment.html["Distribuisci gli ONTAP tools for VMware vSphere"] .

. Scarica il modello OVA degli strumenti ONTAP 10 da https://mysupport.netapp.com/site/["Sito di supporto NetApp"] .
. Nel client vSphere, fare clic con il pulsante destro del mouse sul cluster e fare clic su *Distribuisci modello OVF*
+
image:vmware-vcf-import-nfs-001.png["Distribuisci il modello OVF"]

+
{nbsp}

. Nel *Modello di distribuzione OVF* completare i passaggi per:
+
** Seleziona un modello OVF.
** Seleziona un nome e una cartella.
** Seleziona una risorsa di elaborazione.
** Dettagli della recensione.
** Accettare il contratto di licenza.


. Nella pagina *Configurazione* del modello, selezionare il tipo di distribuzione, specificando se distribuire gli strumenti ONTAP in una configurazione HA. Fare clic su *Avanti* per continuare.
+
image:vmware-vcf-import-nfs-002.png["configurazione - tipo di distribuzione"]

+
{nbsp}

. Nella pagina *Seleziona storage*, seleziona il datastore su cui installare la VM e fai clic su *Avanti*.
. Selezionare la rete su cui comunicherà la VM degli strumenti ONTAP . Fare clic su *Avanti* per continuare.
. Nella finestra "Personalizza modello", compila tutte le informazioni richieste.
+
** Nome utente e password dell'applicazione
** Scegliere se abilitare ASUP (supporto automatico) includendo un URL proxy.
** Nome utente e password dell'amministratore.
** Server NTP.
** Nome utente e password di manutenzione (account di manutenzione utilizzato nella console).
** Fornire gli indirizzi IP richiesti per la configurazione della distribuzione.
** Fornire tutte le informazioni di rete per la configurazione del nodo.
+
image:vmware-vcf-import-nfs-003.png["Personalizza il modello"]

+
{nbsp}



. Infine, fare clic su *Avanti* per continuare e poi su *Fine* per iniziare la distribuzione.


====
.Configurare gli strumenti ONTAP
[%collapsible%open]
====
Una volta installata e avviata la VM degli strumenti ONTAP , saranno necessarie alcune configurazioni di base, come l'aggiunta di server vCenter e sistemi di storage ONTAP da gestire.  Fare riferimento alla documentazione a https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/index.html["Documentazione ONTAP tools for VMware vSphere"] per informazioni dettagliate.

. Fare riferimento a https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/add-vcenter.html["Aggiungi istanze vCenter"] per configurare le istanze vCenter da gestire con gli strumenti ONTAP .
. Per aggiungere un sistema di storage ONTAP , accedi al client vSphere e vai al menu principale a sinistra.  Fare clic su *Strumenti NetApp ONTAP * per avviare l'interfaccia utente.
+
image:vmware-vcf-import-nfs-004.png["strumenti ONTAP aperti"]

+
{nbsp}

. Vai su *Backend di archiviazione* nel menu a sinistra e clicca su *Aggiungi* per accedere alla finestra *Aggiungi backend di archiviazione*.
. Compilare l'indirizzo IP e le credenziali per il sistema di archiviazione ONTAP da gestire.  Fare clic su *Aggiungi* per terminare.
+
image:vmware-vcf-import-nfs-005.png["Aggiungi backend di archiviazione"]




NOTE: In questo caso, il backend di archiviazione viene aggiunto nell'interfaccia utente del client vSphere utilizzando l'indirizzo IP del cluster.  Ciò consente la gestione completa di tutte le SVM nel sistema di archiviazione.  In alternativa, il backend di archiviazione può essere aggiunto e associato a un'istanza vCenter utilizzando ONTAP Tools Manager in `https://loadBalanceIP:8443/virtualization/ui/` .  Con questo metodo è possibile aggiungere solo le credenziali SVM all'interfaccia utente del client vSphere, garantendo un controllo più granulare sull'accesso allo storage.

====
.Fornire un datastore NFS con gli strumenti ONTAP
[%collapsible%open]
====
Gli strumenti ONTAP integrano le funzionalità nell'intera interfaccia utente del client vSphere.  In questa fase verrà eseguito il provisioning di un datastore NFS dalla pagina dell'inventario di archiviazione.

. Nel client vSphere, accedere all'inventario di archiviazione.
. Passare a *AZIONI > Strumenti NetApp ONTAP > Crea datastore*.
+
image:vmware-vcf-import-nfs-006.png["Crea archivio dati"]

+
{nbsp}

. Nella procedura guidata *Crea datastore*, seleziona il tipo di datastore da creare.  Le opzioni sono NFS o VMFS.
. Nella pagina *Nome e protocollo*, inserisci un nome per il datastore, la dimensione e il protocollo NFS da utilizzare.
+
image:vmware-vcf-import-nfs-007.png["Nome e protocollo"]

+
{nbsp}

. Nella pagina *Archiviazione*, selezionare la piattaforma di archiviazione ONTAP e la macchina virtuale di archiviazione (SVM).  Qui puoi anche selezionare qualsiasi criterio di esportazione personalizzato disponibile. Fare clic su *Avanti* per continuare.
+
image:vmware-vcf-import-nfs-008.png["Pagina di archiviazione"]

+
{nbsp}

. Nella pagina *Attributi di archiviazione* selezionare l'aggregato di archiviazione da utilizzare. Fare clic su *Avanti* per continuare.
. Nella pagina *Riepilogo*, rivedere le informazioni e fare clic su *Fine* per avviare il processo di provisioning.  Gli strumenti ONTAP creeranno un volume sul sistema di archiviazione ONTAP e lo monteranno come datastore NFS su tutti gli host ESXi nel cluster.
+
image:vmware-vcf-import-nfs-009.png["Pagina di riepilogo"]



====


=== Convertire il cluster vSphere in VCF 5.2

Nella sezione seguente vengono illustrati i passaggi per distribuire il gestore SDDC e convertire il cluster vSphere 8 in un dominio di gestione VCF 5.2.  Se del caso, per ulteriori dettagli si farà riferimento alla documentazione VMware.

VCF Import Tool, di VMware by Broadcom, è un'utilità utilizzata sia sull'appliance vCenter che sul gestore SDDC per convalidare le configurazioni e fornire servizi di conversione e importazione per gli ambienti vSphere e VCF.

Per ulteriori informazioni, consulta  https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/vcf-import-tool-options-and-parameters-admin.html["Opzioni e parametri dello strumento di importazione VCF"] .

.Copia ed estrai lo strumento di importazione VCF
[%collapsible%open]
====
Gli strumenti di importazione VCF vengono utilizzati sull'appliance vCenter per verificare che il cluster vSphere sia in uno stato di integrità per il processo di conversione o importazione VCF.

Completare i seguenti passaggi:

. Segui i passaggi a https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/copy-the-vcf-import-tool-to-the-target-vcenter-appliance.html["Copia lo strumento di importazione VCF nell'appliance vCenter di destinazione"] in VMware Docs per copiare lo strumento di importazione VCF nella posizione corretta.
. Estrarre il bundle utilizzando il seguente comando:
+
....
tar -xvf vcf-brownfield-import-<buildnumber>.tar.gz
....


====
.Convalida l'appliance vCenter
[%collapsible%open]
====
Utilizzare lo strumento di importazione VCF per convalidare l'appliance vCenter prima della conversione.

. Segui i passaggi a https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/run-a-precheck-on-the-target-vcenter-before-conversion.html["Eseguire un pre-controllo sul vCenter di destinazione prima della conversione"] per eseguire la convalida.
. L'output seguente mostra che l'appliance vCenter ha superato il pre-controllo.
+
image:vmware-vcf-import-nfs-011.png["pre-controllo dello strumento di importazione vcf"]



====
.Distribuire SDDC Manager
[%collapsible%open]
====
Il gestore SDDC deve essere collocato sul cluster vSphere che verrà convertito in un dominio di gestione VCF.

Per completare la distribuzione, seguire le istruzioni di distribuzione in VMware Docs.

Fare riferimento a https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/deploy-the-sddc-manager-appliance-on-the-target-vcenter.html["Distribuire l'appliance SDDC Manager sul vCenter di destinazione"] .

Per maggiori informazioni vederelink:https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-1/commission-hosts.html["Host della Commissione"] nella Guida all'amministrazione VCF.

====
.Creare un file JSON per la distribuzione NSX
[%collapsible%open]
====
Per distribuire NSX Manager durante l'importazione o la conversione di un ambiente vSphere in VMware Cloud Foundation, creare una specifica di distribuzione NSX.  Per la distribuzione di NSX sono necessari almeno 3 host.


NOTE: Quando si distribuisce un cluster NSX Manager in un'operazione di conversione o importazione, viene utilizzata la rete NSX-VLAN.  Per informazioni dettagliate sulle limitazioni della rete NSX-VLAN, fare riferimento alla sezione "Considerazioni prima di convertire o importare ambienti vSphere esistenti in VMware Cloud Foundation".  Per informazioni sulle limitazioni di rete NSX-VLAN, fare riferimento a https://techdocs.broadcom.com/fr/fr/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/considerations-before-converting-or-importing-existing-vsphere-environments-into-vcf.html["Considerazioni prima di convertire o importare ambienti vSphere esistenti in VMware Cloud Foundation"] .

Di seguito è riportato un esempio di file JSON per la distribuzione NSX:

....
{
  "license_key": "xxxxx-xxxxx-xxxxx-xxxxx-xxxxx",
  "form_factor": "medium",
  "admin_password": "NetApp!23456789",
  "install_bundle_path": "/tmp/vcfimport/bundle-133764.zip",
  "cluster_ip": "172.21.166.72",
  "cluster_fqdn": "vcf-m02-nsx01.sddc.netapp.com",
  "manager_specs": [{
    "fqdn": "vcf-m02-nsx01a.sddc.netapp.com",
    "name": "vcf-m02-nsx01a",
    "ip_address": "172.21.166.73",
    "gateway": "172.21.166.1",
    "subnet_mask": "255.255.255.0"
  },
  {
    "fqdn": "vcf-m02-nsx01b.sddc.netapp.com",
    "name": "vcf-m02-nsx01b",
    "ip_address": "172.21.166.74",
    "gateway": "172.21.166.1",
    "subnet_mask": "255.255.255.0"
  },
  {
    "fqdn": "vcf-m02-nsx01c.sddc.netapp.com",
    "name": "vcf-m02-nsx01c",
    "ip_address": "172.21.166.75",
    "gateway": "172.21.166.1",
    "subnet_mask": "255.255.255.0"
  }]
}
....
Copiare il file JSON in una directory su SDDC Manager.

====
.Carica il software su SDDC Manager
[%collapsible%open]
====
Copiare lo strumento di importazione VCF e il bundle di distribuzione NSX nella directory /home/vcf/vcfimport su SDDC Manager.

Vedere https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/seed-software-on-sddc-manager.html["Caricare il software richiesto sull'appliance SDDC Manager"] per istruzioni dettagliate.

====
.Convertire il cluster vSphere in dominio di gestione VCF
[%collapsible%open]
====
Per eseguire il processo di conversione viene utilizzato lo strumento di importazione VCF.  Eseguire il seguente comando dalla directory /home/vcf/vcf-import-package/vcf-brownfield-import-<version>/vcf-brownfield-toolset per visualizzare una stampa delle funzioni dello strumento di importazione VCF:

....
python3 vcf_brownfield.py --help
....
Per convertire il cluster vSphere in un dominio di gestione VCF e distribuire il cluster NSX, eseguire il comando seguente:

....
python3 vcf_brownfield.py convert --vcenter '<vcenter-fqdn>' --sso-user '<sso-user>' --domain-name '<wld-domain-name>' --nsx-deployment-spec-path '<nsx-deployment-json-spec-path>'
....
Per istruzioni complete, fare riferimento a https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/import-workload-domain-into-sddc-manager-inventory.html["Convertire o importare l'ambiente vSphere nell'inventario di SDDC Manager"] .

====
.Aggiungere la licenza al VCF
[%collapsible%open]
====
Dopo aver completato la conversione, è necessario aggiungere la licenza all'ambiente.

. Accedi all'interfaccia utente di SDDC Manager.
. Nel riquadro di navigazione, vai su *Amministrazione > Licenze*.
. Fare clic su *+ Chiave di licenza*.
. Scegli un prodotto dal menu a discesa.
. Inserisci la chiave di licenza.
. Fornire una descrizione della licenza.
. Fare clic su *Aggiungi*.
. Ripetere questi passaggi per ogni licenza.


====


== Demo video per gli ONTAP tools for VMware vSphere 10

.Datastore NFS con ONTAP tools for VMware vSphere 10
video::1e4c3701-0bc2-41fa-ac93-b2680147f351[panopto,width=360]