---
sidebar: sidebar 
permalink: vmware/vmw-vcf-disaster-recovery-nfs.html 
keywords: netapp, vmware, cloud, foundation, vcf, nfs 
summary: Soluzione di disaster recovery per VCF con NetApp Disaster Recovery. 
---
= Implementazione del Disaster Recovery con NetApp Disaster Recovery
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Soluzione di disaster recovery VCF per datastore NFS con NetApp SnapMirror e NetApp Disaster Recovery

La replica a livello di blocco da un sito di produzione a un sito di disaster recovery (DR) offre una strategia resiliente e conveniente per proteggere i carichi di lavoro da interruzioni del sito ed eventi di danneggiamento dei dati, inclusi gli attacchi ransomware.  La replica di NetApp SnapMirror consente ai domini di carico di lavoro VMware VCF 9 in esecuzione su sistemi ONTAP locali, utilizzando datastore NFS o VMFS, di essere replicati su un sistema ONTAP secondario situato in un data center di ripristino designato in cui è distribuito anche VMware.

Per ulteriori informazioni, vedere quanto seguelink:https://docs.netapp.com/us-en/data-services-disaster-recovery/["Documentazione NetApp Disaster Recovery"] .

Questa sezione descrive la configurazione di NetApp Disaster Recovery per stabilire il DR per le macchine virtuali VMware locali.

La configurazione include:

* Creazione di un account NetApp Console e distribuzione di un agente.
* Aggiunta di array ONTAP alla NetApp Console sui sistemi in gestione per facilitare la comunicazione tra VMware vCenter e lo storage ONTAP .
* Configurazione della replica tra siti tramite SnapMirror.
* Impostazione e test di un piano di ripristino per convalidare la prontezza al failover.


NetApp Disaster Recovery, integrato nella NetApp Console, consente alle organizzazioni di individuare senza problemi i propri sistemi di storage VMware vCenter e ONTAP in sede. Una volta individuate, le risorse possono essere definite dagli amministratori, creare piani di disaster recovery, associarle alle risorse appropriate e avviare o testare le operazioni di failover e failback. NetApp SnapMirror fornisce un'efficiente replica a livello di blocco, garantendo che il sito DR rimanga sincronizzato con l'ambiente di produzione tramite aggiornamenti incrementali. Ciò consente un Recovery Point Objective (RPO) di appena cinque minuti.

NetApp Disaster Recovery supporta anche test di disaster recovery non-disruptive. Sfruttando la tecnologia FlexClone di ONTAP, vengono create copie temporanee e a basso consumo di spazio del datastore NFS dallo Snapshot replicato più recente, senza influire sui carichi di lavoro di produzione o comportare costi di archiviazione aggiuntivi. Dopo il test, l'ambiente può essere facilmente smantellato, preservando l'integrità dei dati replicati.

In caso di failover effettivo, NetApp Console orchestra il processo di ripristino, attivando automaticamente le macchine virtuali protette nel sito DR designato con un intervento minimo da parte dell'utente. Quando il sito primario viene ripristinato, il servizio inverte la relazione SnapMirror e replica tutte le modifiche sul sito originale, consentendo un failback fluido e controllato.

Tutte queste funzionalità vengono fornite a un costo notevolmente inferiore rispetto alle tradizionali soluzioni di disaster recovery.

image::vmw-vcf-dr-nfs-001.png[Diagramma dell'architettura NetApp Disaster Recovery]



== Iniziare

Per iniziare a utilizzare NetApp Disaster Recovery, utilizzare NetApp Console e quindi accedere al servizio.

. Accedi alla NetApp Console.
. Dal menu di navigazione a sinistra della NetApp Console , selezionare Protezione > Disaster Recovery.
. Viene visualizzata la dashboard NetApp Disaster Recovery .
+
image::vmw-vcf-dr-nfs-002.png[Dashboard NetApp Disaster Recovery]



Prima di configurare il piano di disaster recovery, assicurarsi di quanto seguelink:https://docs.netapp.com/us-en/data-services-disaster-recovery/get-started/dr-prerequisites.html["prerequisiti"] sono soddisfatte:

* L'agente Console è configurato in NetApp Console.
* L'istanza dell'agente ha connettività con il dominio del carico di lavoro di origine e di destinazione vCenter e con i sistemi di archiviazione.
* Cluster NetApp Data ONTAP per fornire datastore di archiviazione NFS o VMFS.
* I sistemi di storage NetApp on-premise che ospitano datastore NFS o VMFS per VMware vengono aggiunti in NetApp Console.
* Quando si utilizzano nomi DNS, è necessario che sia attiva la risoluzione DNS. In caso contrario, utilizzare gli indirizzi IP per vCenter.
* La replica SnapMirror è configurata per i volumi di datastore basati su NFS o VMFS designati.
* Assicurarsi che l'ambiente disponga di versioni supportate dei server vCenter Server ed ESXi.


Una volta stabilita la connettività tra il sito di origine e quello di destinazione, procedere con la configurazione, che dovrebbe richiedere un paio di clic e circa 3-5 minuti.

Nota: NetApp consiglia di distribuire l'agente Console nel sito di destinazione o in un terzo sito, in modo che l'agente possa comunicare tramite la rete con le risorse di origine e di destinazione.

In questa dimostrazione, i domini del carico di lavoro sono configurati con storage ONTAP NFS.  I passaggi in termini di flusso di lavoro rimangono gli stessi per i datastore basati su VMFS.

image::vmw-vcf-dr-nfs-003.png[Dashboard dettagliata NetApp Disaster Recovery]



== Configurazione NetApp Disaster Recovery

Il primo passo nella preparazione al disaster recovery è individuare e aggiungere le risorse di origine vCenter e storage a NetApp Disaster Recovery.

Aprire NetApp Console e selezionare Protezione > Disaster Recovery dal menu di navigazione a sinistra. Selezionare Siti e quindi scegliere Aggiungi. Inserisci un nome per il nuovo sito di origine e le sue posizioni. Ripetere il passaggio per aggiungere il sito e la posizione di destinazione.

image::vmw-vcf-dr-nfs-004.png[Dashboard dettagliata NetApp Disaster Recovery]

Aggiungere le seguenti piattaforme:

* Dominio del carico di lavoro di origine vCenter
* Dominio del carico di lavoro di destinazione vCenter.


Una volta aggiunti i vCenter, viene attivata la rilevazione automatica.



== Configurazione della replicazione dello storage tra l'array del sito di origine e l'array del sito di destinazione

SnapMirror fornisce la replica dei dati in un ambiente NetApp . Basata sulla tecnologia NetApp Snapshot®, la replica SnapMirror è estremamente efficiente perché replica solo i blocchi che sono stati modificati o aggiunti dall'aggiornamento precedente. SnapMirror può essere facilmente configurato tramite NetApp OnCommand® System Manager o ONTAP CLI. NetApp Disaster Recovery crea anche la relazione SnapMirror, a condizione che il cluster e il peering SVM siano configurati in anticipo.

Nei casi in cui lo storage primario non è completamente perso, SnapMirror fornisce un mezzo efficiente per risincronizzare i siti primario e DR. SnapMirror può risincronizzare i due siti, trasferendo solo i dati modificati o nuovi dal sito DR al sito primario, semplicemente invertendo le relazioni SnapMirror . Ciò significa che i piani di replica in NetApp Disaster Recovery possono essere risincronizzati in entrambe le direzioni dopo un failover senza dover ricopiare l'intero volume. Se una relazione viene risincronizzata nella direzione inversa, solo i nuovi dati scritti dall'ultima sincronizzazione riuscita della copia Snapshot vengono inviati alla destinazione.


NOTE: Se la relazione SnapMirror è già configurata per il volume tramite CLI o System Manager, NetApp Disaster Recovery rileva la relazione e continua con le restanti operazioni del flusso di lavoro.



== Come impostare le relazioni di replica per NetApp Disaster Recovery

Il processo di base per creare la replica SnapMirror rimane lo stesso per qualsiasi applicazione.  Il modo più semplice è sfruttare NetApp Disaster Recovery , che automatizzerà il flusso di lavoro di replicazione a condizione che siano soddisfatti i due criteri seguenti: Il processo può essere manuale o automatizzato. Il modo più semplice consiste nell'utilizzare NetApp Disaster Recovery, che automatizza il flusso di lavoro di replica a condizione che vengano soddisfatti i due criteri seguenti:

* I cluster di origine e di destinazione hanno una relazione peer.
* L'SVM di origine e l'SVM di destinazione hanno una relazione peer.


NetApp Console fornisce anche un'opzione alternativa per configurare la replica SnapMirror mediante un semplice trascinamento del sistema ONTAP di origine nell'ambiente sulla destinazione per avviare la procedura guidata che guida attraverso il resto del processo.



== Cosa può fare per te NetApp Disaster Recovery ?

Dopo aver aggiunto i siti di origine e di destinazione, NetApp Disaster Recovery esegue automaticamente un'analisi approfondita e visualizza le VM insieme ai metadati associati. NetApp Disaster Recovery rileva inoltre automaticamente le reti e i gruppi di porte utilizzati dalle VM e li popola.

image::vmw-vcf-dr-nfs-005.png[Siti NetApp Console]

Dopo aver aggiunto i siti, configurare il piano di replica selezionando le piattaforme vCenter di origine e di destinazione e scegliere i gruppi di risorse da includere nel piano, insieme al raggruppamento delle modalità di ripristino e accensione delle applicazioni e alla mappatura di cluster e reti. Per definire il piano di ripristino, accedere alla scheda *Piani di replica* e fare clic su *Aggiungi*.

In questa fase, le VM possono essere raggruppate in gruppi di risorse. I gruppi di risorse NetApp Disaster Recovery consentono di raggruppare un set di VM dipendenti in gruppi logici che contengono i relativi ordini di avvio e ritardi di avvio che possono essere eseguiti al momento del ripristino. I gruppi di risorse possono essere creati durante la creazione del piano di replicazione oppure utilizzando la scheda Gruppo di risorse nella barra di navigazione a sinistra.

Per prima cosa, assegna un nome al piano di replica e seleziona il vCenter di origine e il vCenter di destinazione.

image::vmw-vcf-dr-nfs-006.png[Destinazione di NetApp Disaster Recovery vCenter]

Il passaggio successivo consiste nello scegliere se creare un piano di replica con gruppi di risorse, macchine virtuali o datastore. Selezionare un gruppo di risorse esistente e, se non viene creato alcun gruppo di risorse, la procedura guidata aiuta a raggruppare le macchine virtuali richieste (in pratica a creare gruppi di risorse funzionali) in base agli obiettivi di ripristino. Ciò aiuta anche a definire la sequenza operativa di come devono essere ripristinate le macchine virtuali delle applicazioni.

image::vmw-vcf-dr-nfs-007.png[NetApp Disaster Recovery seleziona le VM da proteggere]


NOTE: Il gruppo di risorse consente di impostare l'ordine di avvio utilizzando la funzionalità di trascinamento della selezione. Può essere utilizzato per modificare facilmente l'ordine in cui le VM verranno accese durante il processo di ripristino.

Una volta creati i gruppi di risorse tramite il piano di replica, il passaggio successivo consiste nel creare la mappatura per ripristinare macchine virtuali e applicazioni in caso di disastro. In questo passaggio, specificare come le risorse dall'ambiente di origine vengono mappate alla destinazione. Ciò include risorse di elaborazione, reti virtuali, personalizzazione IP, pre- e post-script, ritardi di avvio, coerenza delle applicazioni e così via. Per informazioni dettagliate, fare riferimento alink:https://docs.netapp.com/us-en/data-services-disaster-recovery/use/drplan-create.html#map-source-resources-to-the-target["Creare un piano di replicazione"] . Come indicato nei prerequisiti, la replica SnapMirror può essere configurata in anticipo oppure DRaaS può configurarla utilizzando l'RPO e il conteggio di conservazione specificati durante la creazione del piano di replica.

Nota: per impostazione predefinita, vengono utilizzati gli stessi parametri di mappatura sia per le operazioni di test che per quelle di failover. Per impostare mapping diversi per l'ambiente di test, selezionare l'opzione Test mapping dopo aver deselezionato la casella di controllo "Usa gli stessi mapping per failover e test mapping". Una volta completata la mappatura delle risorse, fare clic su Avanti.

image::vmw-vcf-dr-nfs-008.png[Mappatura delle risorse di emergenza NetApp]

Una volta fatto, rivedi le mappature create e poi fai clic su Aggiungi piano.

image::vmw-vcf-dr-nfs-009.png[Revisione della mappatura delle risorse NetApp Disaster Recovery]


NOTE: In un piano di replicazione è possibile includere VM di volumi diversi e SVM. A seconda del posizionamento della VM (sullo stesso volume o su volumi separati all'interno della stessa SVM, volumi separati su SVM diverse), NetApp Disaster Recovery crea uno snapshot del gruppo di coerenza.

image::vmw-vcf-dr-nfs-010.png[Piani di replicazione NetApp Disaster Recovery]

Non appena il piano viene creato, viene attivata una serie di convalide e la replica e le pianificazioni SnapMirror vengono configurate in base alla selezione.

image::vmw-vcf-dr-nfs-011.png[Monitoraggio dei processi NetApp Disaster Recovery]

NetApp Disaster Recovery è costituito dai seguenti flussi di lavoro:

* Failover di test (incluse simulazioni automatiche periodiche)
* Test di failover di pulizia
* Failover:
+
** Migrazione pianificata (estendere il caso d'uso per un failover una tantum)
** Ripristino dopo un disastro


* Rifasamento


image::vmw-vcf-dr-nfs-012.png[Azioni del piano di replica NetApp Disaster Recovery]



== Failover di prova

Il failover di prova in NetApp Disaster Recovery è una procedura operativa che consente agli amministratori VMware di convalidare completamente i propri piani di ripristino senza interrompere gli ambienti di produzione.

image::vmw-vcf-dr-nfs-013.png[Failover di test del piano di replica NetApp Disaster Recovery]

NetApp Disaster Recovery incorpora la possibilità di selezionare lo snapshot come funzionalità facoltativa nell'operazione di failover di prova. Questa funzionalità consente all'amministratore VMware di verificare che tutte le modifiche apportate di recente all'ambiente vengano replicate nel sito di destinazione e siano quindi presenti durante il test. Tali modifiche includono patch al sistema operativo guest della VM.

image::vmw-vcf-dr-nfs-014.png[Conferma del failover del test del piano di replica NetApp Disaster Recovery]

Quando l'amministratore VMware esegue un'operazione di failover di prova, NetApp Disaster Recovery automatizza le seguenti attività:

* Attivazione delle relazioni SnapMirror per aggiornare l'archiviazione nel sito di destinazione con tutte le modifiche recenti apportate nel sito di produzione.
* Creazione di volumi NetApp FlexClone dei volumi FlexVol sull'array di archiviazione DR.
* Collegamento dei datastore nei volumi FlexClone agli host ESXi nel sito DR.
* Collegamento degli adattatori di rete della VM alla rete di prova specificata durante la mappatura.
* Riconfigurazione delle impostazioni di rete del sistema operativo guest della VM come definite per la rete nel sito DR.
* Esecuzione di tutti i comandi personalizzati memorizzati nel piano di replicazione.
* Accensione delle VM nell'ordine definito nel piano di replica.


image::vmw-vcf-dr-nfs-015.png[Risultato del failover del test del piano di replica NetApp Disaster Recovery]



== Operazione di test di failover di pulizia

L'operazione di test di failover di pulizia avviene dopo il completamento del test del piano di replica e quando l'amministratore VMware risponde al prompt di pulizia.

image::vmw-vcf-dr-nfs-016.png[Pulizia del failover del test del piano di replica NetApp Disaster Recovery]

Questa azione reimposterà le macchine virtuali (VM) e lo stato del piano di replica allo stato pronto. Quando l'amministratore VMware esegue un'operazione di ripristino, NetApp Disaster Recovery completa il seguente processo:

. Spegne ogni VM recuperata nella copia FlexClone utilizzata per il test.
. Elimina il volume FlexClone utilizzato per presentare le VM recuperate durante il test.




== Migrazione pianificata e failover

NetApp Disaster Recovery dispone di due metodi per eseguire un failover reale: migrazione pianificata e failover. Il primo metodo, la migrazione pianificata, incorpora l'arresto delle VM e la sincronizzazione della replicazione dello storage nel processo per ripristinare o spostare efficacemente le VM nel sito di destinazione. La migrazione pianificata richiede l'accesso al sito di origine. Il secondo metodo, il failover, è un failover pianificato/non pianificato in cui le VM vengono ripristinate nel sito di destinazione dall'ultimo intervallo di replicazione dell'archiviazione che è stato possibile completare. A seconda dell'RPO progettato nella soluzione, è possibile che si verifichi una certa perdita di dati nello scenario DR.

image::vmw-vcf-dr-nfs-017.png[Azione di failover del piano di replica NetApp Disaster Recovery]

image::vmw-vcf-dr-nfs-018.png[Conferma dell'azione di failover del piano di replica NetApp Disaster Recovery]

Quando l'amministratore VMware esegue un'operazione di failover, NetApp Disaster Recovery automatizza le seguenti attività:

* Interrompere ed eseguire il failover delle relazioni NetApp SnapMirror .
* Collegare i datastore replicati agli host ESXi nel sito DR.
* Collegare gli adattatori di rete della VM alla rete del sito di destinazione appropriata.
* Riconfigurare le impostazioni di rete del sistema operativo guest della VM come definite per la rete nel sito di destinazione.
* Eseguire eventuali comandi personalizzati memorizzati nel piano di replicazione.
* Accendere le VM nell'ordine definito nel piano di replica.


image::vmw-vcf-dr-nfs-019.png[vSphere Client - VM accese]



== Rifasamento

Un failback è una procedura facoltativa che ripristina la configurazione originale dei siti di origine e di destinazione dopo un ripristino.

image::vmw-vcf-dr-nfs-020.png[Azione di failback del piano di replica NetApp Disaster Recovery]

Gli amministratori VMware possono configurare ed eseguire una procedura di failback quando sono pronti a ripristinare i servizi sul sito di origine.


NOTE: NetApp Disaster Recovery replica (risincronizza) tutte le modifiche sulla macchina virtuale di origine prima di invertire la direzione della replica.

Questo processo inizia da una relazione che ha completato il failover verso una destinazione e prevede i seguenti passaggi:

* Spegnere e annullare la registrazione delle macchine virtuali e dei volumi sul sito di destinazione.
+
image::vmw-vcf-dr-nfs-021.png[vSphere Client - attività recenti]

* Interrompere la relazione SnapMirror sulla sorgente originale per renderla di lettura/scrittura.
* Risincronizzare la relazione SnapMirror per invertire la replica.
* Montare il volume sulla sorgente, accendere e registrare le macchine virtuali di origine.
+
image::vmw-vcf-dr-nfs-022.png[vSphere Client - VM accese]



Per maggiori dettagli sull'accesso e la configurazione NetApp Disaster Recovery, vederelink:https://docs.netapp.com/us-en/data-services-disaster-recovery/get-started/dr-intro.html["Scopri di più su NetApp Disaster Recovery per VMware"] .



== Monitoraggio e dashboard

Da NetApp Disaster Recovery o da ONTAP CLI, è possibile monitorare lo stato di integrità della replica per i volumi del datastore appropriati, mentre lo stato di un failover o di un failover di prova può essere monitorato tramite Job Monitoring.

image::vmw-vcf-dr-nfs-023.png[Monitoraggio dei processi NetApp Disaster Recovery]


NOTE: Se un lavoro è in corso o in coda e si desidera interromperlo, è disponibile un'opzione per annullarlo.

Grazie alla dashboard NetApp Disaster Recovery , puoi valutare con sicurezza lo stato dei siti di disaster recovery e dei piani di replica. Ciò consente agli amministratori di identificare rapidamente siti e piani integri, disconnessi o degradati.

image::vmw-vcf-dr-nfs-024.png[Dashboard aggiornata NetApp Disaster Recovery]

Si tratta di una soluzione potente per gestire un piano di disaster recovery personalizzato e su misura. Il failover può essere eseguito come failover pianificato oppure con un clic su un pulsante quando si verifica un disastro e si decide di attivare il sito DR.
