---
sidebar: sidebar 
permalink: proxmox/proxmox-ontap-fc.html 
keywords: netapp, proxmox, proxmox ve, fc, fibre channel, lvm, ontap, storage 
summary: 'Configurare Logical Volume Manager (LVM) con Fibre Channel per l"ambiente virtuale Proxmox utilizzando ONTAP. Questa procedura include la configurazione multipath, il provisioning LUN, la configurazione igroup e la creazione di gruppi di volumi per l"archiviazione condivisa.' 
---
= Configurare LVM con FC per Proxmox VE
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Configurare Logical Volume Manager (LVM) per l'archiviazione condivisa tra gli host Proxmox Virtual Environment (VE) utilizzando il protocollo Fibre Channel con NetApp ONTAP. Questa configurazione consente l'accesso allo storage a livello di blocco con prestazioni elevate e bassa latenza.



== Attività iniziali dell'amministratore della virtualizzazione

Completare queste attività iniziali per preparare gli host Proxmox VE per la connettività FC e raccogliere le informazioni necessarie per l'amministratore dell'archiviazione.

. Verificare che siano disponibili due interfacce HBA.
. Assicurarsi che multipath-tools sia installato su tutti gli host Proxmox VE e venga avviato all'avvio.
+
[source, shell]
----
apt list | grep multipath-tools
# If need to install, execute the following line.
apt-get install multipath-tools
systemctl enable multipathd
----
. Raccogliere il WWPN per tutti gli host Proxmox VE e fornirlo all'amministratore dell'archiviazione.
+
[source, shell]
----
cat /sys/class/fc_host/host*/port_name
----




== Attività dell'amministratore dell'archiviazione

Se non hai familiarità con ONTAP, utilizza System Manager per un'esperienza migliore.

. Assicurarsi che l'SVM sia disponibile con il protocollo FC abilitato. Seguire link:https://docs.netapp.com/us-en/ontap/san-admin/provision-storage.html["Documentazione ONTAP 9"].
. Creare due LIF per controller dedicati a FC.
+
image:proxmox-ontap-fc-001.png["Dettagli dell'interfaccia FC"]

. Creare un igroup e popolare gli iniziatori FC host.
. Creare la LUN con la dimensione desiderata sulla SVM e presentarla all'igroup creato nel passaggio precedente. Assicurarsi che la protezione anti-ransomware sia abilitata nella scheda sicurezza per i sistemi ASA e nella scheda sicurezza del volume per i sistemi AFF/ FAS .
+
image:proxmox-ontap-fc-002.png["dettagli lun"]

. Notificare all'amministratore della virtualizzazione che la LUN è stata creata.




== Attività finali dell'amministratore della virtualizzazione

Completare queste attività per configurare la LUN come storage LVM condiviso in Proxmox VE.

. Passare a una shell su ciascun host Proxmox VE nel cluster e verificare che il disco sia visibile.
+
[source, shell]
----
lsblk -S
rescan-scsi-bus.sh
lsblk -S
----
. Verificare che il dispositivo appaia nell'elenco multipath.
+
[source, shell]
----
multipath -ll
multipath -a /dev/sdX  # replace sdX with the device name
multipath -r
multipath -ll
----
. Creare il gruppo di volumi.
+
[source, shell]
----
vgcreate <volume group name> /dev/mapper/<device id>
# Where <volume group name> is the desired name for the volume group and <device id> is the multipath device id.
pvs
# Verify the physical volume is part of the volume group.
vgs
# Verify the volume group is created.
----
. Utilizzo dell'interfaccia utente di gestione in `https:<proxmox node>:8006`, fare clic su Datacenter, selezionare Storage, fare clic su Aggiungi e selezionare LVM.
+
.Mostra esempio
[%collapsible]
====
image:proxmox-ontap-fc-003.png["navigazione di archiviazione lvm"]

====
. Fornire il nome dell'ID di archiviazione, scegliere il gruppo di volumi esistente e selezionare il gruppo di volumi appena creato con la CLI. Seleziona l'opzione condivisa. Con Proxmox VE 9 e versioni successive, abilitare `Allow Snapshots as Volume-Chain` opzione, visibile quando la casella di controllo Avanzate è abilitata.
+
.Mostra esempio
[%collapsible]
====
image:proxmox-ontap-fc-004.png["creazione di storage lvm"]

====
. Di seguito è riportato il file di configurazione di archiviazione di esempio per LVM tramite FC:
+
.Mostra esempio
[%collapsible]
====
image:proxmox-ontap-fc-005.png["configurazione lvm fc"]

====
+
Con Proxmox VE 9 e versioni successive, il file di configurazione dell'archiviazione include l'opzione aggiuntiva `snapshot-as-volume-chain 1` Quando `Allow Snapshots as Volume-Chain` è abilitato.


