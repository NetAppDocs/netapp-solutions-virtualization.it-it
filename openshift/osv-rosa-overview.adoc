---
sidebar: sidebar 
permalink: openshift/osv-rosa-overview.html 
keywords: OpenShift, OCP, Trident, NetApp ONTAP, Red Hat OpenShift, OpenShift Virtualization, ROSA, CNV, Container Native Virtualization, Red Hat OpenShift Virtualization 
summary: Virtualizzazione Red Hat OpenShift su ROSA 
---
= Distribuisci Red Hat OpenShift Virtualization con FSx per ONTAP su un cluster ROSA
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Impostare Amazon FSx for NetApp ONTAP come StorageClass predefinito per un cluster ROSA (Red Hat OpenShift Service on AWS).  Questa procedura include la creazione di una VM che sfrutta l'archiviazione FSx ONTAP per i suoi volumi, la revisione di tutti gli oggetti creati per la VM e la connessione alla VM tramite credenziali guest.

Esamineremo anche la connessione alla macchina virtuale utilizzando le credenziali guest e il riavvio della macchina virtuale.  Infine, eseguiremo una migrazione live della macchina virtuale dal nodo corrente a un nuovo nodo.  Esamineremo il contenuto dell'archiviazione su disco dopo il riavvio della VM e la migrazione in tempo reale.



== Prerequisiti

* link:https://signin.aws.amazon.com/signin?redirect_uri=https://portal.aws.amazon.com/billing/signup/resume&client_id=signup["Account AWS"]
* link:https://console.redhat.com/["Un account Red Hat"]
* Utente IAMlink:https://www.rosaworkshop.io/rosa/1-account_setup/["con le autorizzazioni appropriate"] per creare e accedere al cluster ROSA
* link:https://aws.amazon.com/cli/["Interfaccia a riga di comando AWS"]
* link:https://console.redhat.com/openshift/downloads["ROSA CLI"]
* link:https://console.redhat.com/openshift/downloads["Interfaccia della riga di comando di OpenShift"](oc)
* link:https://docs.aws.amazon.com/eks/latest/userguide/helm.html["Documentazione di Helm 3"]
* link:https://docs.openshift.com/rosa/rosa_hcp/rosa-hcp-sts-creating-a-cluster-quickly.html["Un cluster HCP ROSA"](con almeno 3 nodi worker bare-metal)
* link:https://console.redhat.com/openshift/overview["Accesso alla console web di Red Hat OpenShift"]
* Trident 25.02 o successivo Per il prerequisito Trident sopra indicato, vederelink:osv-trident-install.html["Sezione di installazione Trident"] per i dettagli.
* link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.17/html/virtualization/installing#virt-aws-bm_preparing-cluster-for-virt["Virtualizzazione OpenShift installata sul cluster ROSA"]


A partire dalla versione Trident 25.02, è possibile preparare facilmente i nodi worker del cluster ROSA (o di qualsiasi cluster OpenShift) per eseguire operazioni iSCSI sullo storage FSxN. Esistono 2 semplici modi per installare Trident 25.02 (o versione successiva) che automatizza la preparazione del nodo worker per iSCSI. Prima di installare OpenShift Virtualization, dovresti aver già creato il backend Trident, la classe di archiviazione e gli oggetti della classe snapshot del volume e averli impostati come predefiniti.  Puoi fare riferimento allink:osv-trident-install.html["Sezione di installazione Trident"] per i dettagli.



== Configurazione iniziale

Impostare il backend Trident, la classe di archiviazione e VolumeSnapshotClass.  Puoi fare riferimento allink:osv-trident-install.html["Sezione di installazione Trident"] per i dettagli.

Esempio di yaml per creare un oggetto backend trident

[source, yaml]
----
cat tbc.yaml
apiVersion: v1
kind: Secret
metadata:
  name: backend-tbc-ontap-san-secret
type: Opaque
stringData:
  username: fsxadmin
  password: <password for the fsxN filesystem>
---
apiVersion: trident.netapp.io/v1
kind: TridentBackendConfig
metadata:
  name: backend-tbc-ontap-san
spec:
  version: 1
  storageDriverName: ontap-san
  managementLIF: <management lif of fsxN filesystem>
  backendName: backend-tbc-ontap-san
  svm: svm_FSxNForROSAiSCSI
  credentials:
    name: backend-tbc-ontap-san-secret

cat sc.yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: trident-csi
provisioner: csi.trident.netapp.io
parameters:
  backendType: "ontap-san"
  media: "ssd"
  provisioningType: "thin"
  snapshots: "true"
allowVolumeExpansion: true

cat snapshot-class.yaml
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshotClass
metadata:
  name: fsx-snapclass
driver: csi.trident.netapp.io
deletionPolicy: Retain

#oc create -f tbc,yaml -n trident
#oc create -f sc.yaml
#oc create -f snapshot-class.yaml
----
Prima di installare OpenShift Virtualization, assicurarsi che la classe di archiviazione e la classe di snapshot del volume siano configurate come predefinite.  Per i dettagli su come impostare i valori predefiniti, è possibile fare riferimento alink:osv-trident-install.html["Impostazione dei valori predefiniti con la sezione Trident Storage e Snapshot Class"] per i dettagli.



=== **Crea una VM dal modello**

Utilizzare la console Web per creare una VM da un modello.  Dalla console RedHat OpenShiftService su AWS, creare una macchina virtuale.  Nel cluster sono disponibili dei modelli che possono essere utilizzati per creare la VM.  Nello screenshot qui sotto, scegliamo Fedora VM da questo elenco.  Assegna un nome alla VM, quindi fai clic su **Personalizza macchina virtuale**.  Selezionare la scheda **Dischi** e fare clic su **Aggiungi dischi**.  Cambiare preferibilmente il nome del disco con qualcosa di significativo, assicurarsi che **trident-csi** sia selezionato per la classe di archiviazione.  Fare clic su **Salva**.  Fare clic su **Crea macchina virtuale**

Dopo alcuni minuti, la VM è in esecuzioneimage:redhat-openshift-ocpv-rosa-003.png["OCP-v Crea VM da modello"]

image:redhat-openshift-ocpv-rosa-004.png["Fonti del modello OCP-v disponibili"]

image:redhat-openshift-ocpv-rosa-005.png["OCP-v Personalizza VM"]

image:redhat-openshift-ocpv-rosa-006.png["Scheda Dischi OCP-v"]

image:redhat-openshift-ocpv-rosa-007.png["OCP-v Aggiungi disco"]

image:redhat-openshift-ocpv-rosa-008.png["VM OCP-v in esecuzione"]



=== **Esamina tutti gli oggetti creati per la VM**

I dischi di archiviazione.image:redhat-openshift-ocpv-rosa-009.png["Dischi di archiviazione OCP-v"]

I file system della VM mostreranno le partizioni, il tipo di file system e i punti di montaggio.image:redhat-openshift-ocpv-rosa-010.png["Filesystem OCP-v"]

Vengono creati 2 PVC per la VM, uno dal disco di avvio e uno per il disco hot plug.image:redhat-openshift-ocpv-rosa-011.png["PVC VM OCP-v"]

Il PVC per il disco di avvio mostra che la modalità di accesso è ReadWriteMany e la classe di archiviazione è trident-csi.image:redhat-openshift-ocpv-rosa-012.png["Disco di avvio VM OCP-v PVC"]

Allo stesso modo, il PVC per il disco hot-plug mostra che la modalità di accesso è ReadWriteMany e la classe di archiviazione è trident-csi.image:redhat-openshift-ocpv-rosa-013.png["OCP-v VM hotplug disk PVC"]

Nello screenshot qui sotto possiamo vedere che il pod per la VM ha lo stato In esecuzione.image:redhat-openshift-ocpv-rosa-014.png["VM OCP-v in esecuzione"]

Qui possiamo vedere i due volumi associati al pod VM e i 2 PVC ad essi associati.image:redhat-openshift-ocpv-rosa-015.png["PVC e PV VM OCP-v"]



=== **Connettiti alla VM**

Fare clic sul pulsante "Apri console web" e accedere utilizzando le credenziali ospiteimage:redhat-openshift-ocpv-rosa-016.png["Connessione VM OCP-v"]

image:redhat-openshift-ocpv-rosa-017.png["Accesso OCP-v"]

Emettere i seguenti comandi

[source]
----
$ df (to display information about the disk space usage on a file system).
----
[source]
----
$ dd if=/dev/urandom of=random.dat bs=1M count=10240 (to create a file called random.dat in the home dir and fill it with random data).
----
Il disco contiene 11 GB di dati.image:redhat-openshift-ocpv-rosa-018.png["La VM OCP-v riempie il disco"]

Utilizzare vi per creare un file di testo di esempio che utilizzeremo per i test.image:redhat-openshift-ocpv-rosa-019.png["OCP-v crea un file"]

**Blog correlati**

link:https://community.netapp.com/t5/Tech-ONTAP-Blogs/Unlock-Seamless-iSCSI-Storage-Integration-A-Guide-to-FSxN-on-ROSA-Clusters-for/ba-p/459124["Sblocca l'integrazione perfetta dell'archiviazione iSCSI: una guida a FSxN su cluster ROSA per iSCSI"]

link:https://community.netapp.com/t5/Tech-ONTAP-Blogs/Simplifying-Trident-Installation-on-Red-Hat-OpenShift-with-the-New-Certified/ba-p/459710["Semplificazione dell'installazione Trident su Red Hat OpenShift con il nuovo operatore Trident certificato"]
